@model IEnumerable<EshopMVC.Models.Product>

@{
    ViewBag.Title = "لیست محصولات";
}

<h2>لیست محصولات</h2>

<p>
    <a href="@Url.Action("Create","Products")" class="btn btn-sm btn-success"><i class="glyphicon glyphicon-plus"> <span>ایجاد محصول جدید</span></i></a>
</p>
@AntiForgery.GetHtml()
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Category.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Company.PersianName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.ModelName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Description)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr id="row_@item.Id">
            <td>
                @Html.DisplayFor(modelItem => item.Category.Name)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Company.PersianName)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.ModelName)
            </td>
            <td>
                @item.Description.Substring(0, 10)
            </td>
            <td>

                <a href="@Url.Action("Edit","Products",new {id = item.Id})" class="btn btn-sm btn-warning"><i class="glyphicon glyphicon-edit"> <span>ویرایش</span></i></a>
                <a href="@Url.Action("Details","Products",new {id = item.Id})" class="btn btn-sm btn-primary"><i class="glyphicon glyphicon-info-sign"> <span>جزئیات</span> </i></a>
                <a onclick="Delete(@item.Id)" class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-trash"> <span>حذف</span> </i></a>
            </td>
        </tr>
    }

</table>


@section scripts
{
    <script>


        function Delete(id) {
            swal({
                title: "آیا مطمئن هستید؟",
                text: "بعد از حذف ، امکان بازیابی اطلاعات وجود ندارد !",
                icon: "warning",
                buttons: true,
                dangerMode: true,
                buttons: ['انصراف', 'حذف']
            })
                .then((willDelete) => {
                    if (willDelete) {
                        var token = $("input[name = __RequestVerificationToken]").val();
                        $.post("/Products/Delete/" + id,
                            {
                                __RequestVerificationToken: token
                            },

                            function (result) {
                                if (result) {
                                    swal("عملیات با موفقیت انجام شد.",
                                        {
                                            icon: "success",
                                            button: "تایید"
                                        });
                                    $('#row_' + id).hide('slow');

                                }
                                else {
                                    swal("خطایی در انجام عملیات رخ داد . دوباره تلاش کنید.", {
                                        icon: "error",
                                        button: "تایید"
                                    });
                                }
                            });

                    }

                });
        }

    </script>

}
